<!DOCTYPE html><html><head><title>Tape | Software and Hardware Requirements</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><meta name="robots" content="index,follow"><meta name="theme-color" content="#212121"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="shortcut icon" href="/docs/favicon.ico?2"><link href="https://fonts.googleapis.com/css?family=Hind:400,700&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:300,400&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/icon?family=Material+Icons%7CMaterial+Icons+Outlined&amp;display=swap" rel="stylesheet"><style>
      body, input, button {
        font-family: 'Hind', sans-serif;
      }

      code, .hljs {
        font-family: 'Source Code Pro', 'Courier New', Courier, monospace;
      }

      .icon-font {
        font-family: 'Material Icons';
        font-weight: normal;
        font-style: normal;
        font-size: 24px;  /* Preferred icon size */
        display: inline-block;
        line-height: 1;
        text-transform: none;
        letter-spacing: normal;
        word-wrap: normal;
        white-space: nowrap;
        direction: ltr;
      
        /* Support for all WebKit browsers. */
        -webkit-font-smoothing: antialiased;
        /* Support for Safari and Chrome. */
        text-rendering: optimizeLegibility;
      
        /* Support for Firefox. */
        -moz-osx-font-smoothing: grayscale;
      
        /* Support for IE. */
        font-feature-settings: 'liga';
      }

      .icon-font.outline {
        font-family: 'Material Icons Outlined';
      }
    </style><link href="/docs/assets/codedoc-styles.css" rel="stylesheet"><script async="" defer="" src="/docs/assets/codedoc-bundle.js"></script></head><body><div class="header-0-0-3"></div><div id="-codedoc-container" class="container"><h1 id="software-and-hardware-requirements" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Software and Hardware Requirements</h1><p>This guide outlines minimum software and hardware requirements for deploying Tape. Requirements may vary based on utilization and observing performance of pilot projects is recommended prior to scale out.</p><h2 id="software-requirements" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Software Requirements</h2><h3 id="client-software" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Client Software</h3><h4 id="http-web" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span><span class="icon-font" data-ignore-text="" style="vertical-align: sub">http</span> Web</h4><p>Web client for desktop, mobile and tablet browsers.</p><table><thead><th>Browser</th><th>Version</th></thead><tbody><tr><td>Chrome</td><td>- v77+</td></tr><tr><td>Firefox</td><td>- v68+</td></tr><tr><td>Safari</td><td>- v12+</td></tr><tr><td>Edge</td><td>- v44+</td></tr></tbody></table><h3 id="mail_outline-email-client" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span><span class="icon-font" data-ignore-text="" style="vertical-align: sub">mail_outline</span> Email Client</h3><ul><li><strong>Desktop clients</strong>: Outlook 2010+, Apple Mail version 7+, Thunderbird 38.2+</li><li><strong>Web based clients</strong>: Office 365, Outlook, Gmail, Yahoo, AOL</li><li><strong>Mobile clients</strong>: iOS Mail App (iOS 7+), Gmail Mobile App (Android, iOS)</li></ul><h2 id="server-software" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Server Software</h2><h3 id="tape-server-operating-system" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Tape Server Operating System</h3><ul><li>Ubuntu 18.04, Debian Buster, CentOS 6+, CentOS 7+, RedHat Enterprise Linux 7+, Oracle Linux 6+, Oracle Linux 7+.</li><li>For custom requests it's possible to usinget the Tape <code>Docker IMAGE</code> on a Docker-compatible operating system (Linux-based OS).</li></ul><h3 id="database-software" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Database Software</h3><ul><li>PostgreSQL 9.4+</li><li>Redis 4.0+</li></ul><h2 id="hardware-requirements" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Hardware Requirements</h2><p>Usage of CPU, RAM, and storage space can vary significantly based on user behavior. These hardware recommendations are based on traditional deployments and may grow or shrink depending on how active your users are.</p><p>Moreover, memory requirements can be driven by peak file sharing activity. Recommendation is based on default 50 MB maximum file size, which can be adjusted from the System Console. Changing this number may change memory requirements.</p><h3 id="people_outline-hardware-requirements-for-team-deployments" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span><span class="icon-font" data-ignore-text="" style="vertical-align: sub">people_outline</span> Hardware Requirements for Team Deployments</h3><p>Most small to medium Tape team deployments can be supported on a single server with the following specifications based on registered users:</p><table><thead><th>Count users</th><th>Hardware Requirements</th></thead><tbody><tr><td>1 - 1,000 users</td><td>1 vCPU/cores, 2 GB RAM</td></tr><tr><td>1,000 - 2,000 users</td><td>2 vCPUs/cores, 4 GB RAM</td></tr></tbody></table><h3 id="hardware-requirements-for-multi-server-deployments" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Hardware Requirements for Multi-Server Deployments</h3><h4 id="scale-requirements" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Scale Requirements</h4><p>It is highly recommended that pilots are run before enterprise-wide deployments in order to estimate full scale usage based on your specific organizational needs.</p><h4 id="system-requirements" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>System Requirements</h4><p>For Enterprise Edition deployments with a multi-server setup, we highly recommend the following systems to support your Tape deployment:</p><ul><li>Prometheus to track system health of your Tape deployment.</li><li>Grafana to visualize the system health metrics collected by Prometheus. Grafana 5.0.0 and later is recommended.</li></ul><h3 id="storage-storage-calculations" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span><span class="icon-font" data-ignore-text="" style="vertical-align: sub">storage</span> Storage Calculations</h3><p>As an alternative to recommended storage sizing above, you can forecast your own storage usage. Begin with a Server approximately 600 MB to 800 MB in size including operating system and database, then add the multiplied product of:</p><ul><li>Estimated storage per user per month, multipled by 12 months in a year</li><li>Estimated mean average number of users in a year</li><li>A 1-2x safety factor</li></ul><blockquote><p><span class="icon-font" data-ignore-text="" style="vertical-align: sub">info</span> <strong>INFORMATION</strong></p><p>It’s recommended that you review storage utilization at least quarterly to ensure adequate free space is available.</p></blockquote><hr><h1 id="introduction" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Introduction</h1><p>A complete Tape installation consists of four major components: a proxy server, a database server, a redis server and the Tape server. You can install all components on one machine, or you can install each component on its own machine. If you have only two machines, then install the proxy and the Tape server on one machine, and install the database on the other machine.</p><p>For the database, you can install PostgreSQL. The proxy is NGINX.</p><blockquote><p><span class="icon-font" data-ignore-text="" style="vertical-align: sub">help</span> <strong>NOTE</strong></p><p>If you have any problems installing then please raise an issue on github.</p></blockquote><p>Install and configure the components in the following order. Note that you need only one OS, either Ubuntu Server 18.04 LTS or Ubuntu Server 20.04 LTS.</p><hr><h1 id="installing-ubuntu-server-1804-lts" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Installing Ubuntu Server 18.04 LTS</h1><p>Install the 64-bit version of Ubuntu Server on each machine that hosts one or more of the components. To install Ubuntu Server 18.04, see the <a href="https://help.ubuntu.com/18.04/installation-guide/amd64/index.html">Ubuntu 18.04 Installation Guide</a>.</p><p>After the system is installed, make sure that it’s up to date with the most recent security patches. Open a terminal window and issue the following commands:</p><pre class=""><code class="undefined -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo apt update" id="code1-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>sudo apt update</div><br></code></pre><pre class=""><code class="undefined -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo apt upgrade" id="code2-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>sudo apt upgrade</div><br></code></pre><p>Now that the system is up to date, you can start installing the components that make up a Tape system.</p><hr><h1 id="installing-ubuntu-server-2004-lts" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Installing Ubuntu Server 20.04 LTS</h1><p>Install the 64-bit version of Ubuntu Server on each machine that hosts one or more of the components. To install Ubuntu Server 20.04, see the <a href="https://help.ubuntu.com/20.04/installation-guide/amd64/index.html">Ubuntu 20.04 Installation Guide</a>.</p><p>After the system is installed, make sure that it’s up to date with the most recent security patches. Open a terminal window and issue the following commands:</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo apt update" id="code3-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> <span class="token function">apt</span> update</div><br></code></pre><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo apt upgrade" id="code4-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> <span class="token function">apt</span> upgrade</div><br></code></pre><p>Now that the system is up to date, you can start installing the components that make up a Tape system.</p><hr><h1 id="installing-postgresql-database-server" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Installing PostgreSQL Database Server</h1><p>Install and set up the database for use by the Tape server.</p><p>Assume that the IP address of this server is <code>10.10.10.1</code>.</p><ol><li><p>Log in to the server that will host the database and issue the following command:</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo apt install postgresql postgresql-contrib" id="code5-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> postgresql postgresql-contrib</div><br></code></pre><p>When the installation is complete, the PostgreSQL server is running, and a Linux user account called <em>postgres</em> has been created.</p></li><li><p>Log in to the <em>postgres</em> account.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo --login --user postgres" id="code6-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> --login --user postgres</div><br></code></pre></li><li><p>Start the PostgreSQL interactive terminal.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="psql" id="code7-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>psql</div><br></code></pre></li><li><p>Create the Tape database.</p><pre class=""><code class="sql -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="CREATE DATABASE tape;" id="code8-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> tape<span class="token punctuation">;</span></div><br></code></pre></li><li><p>Create the Tape user 'tapeuser'.</p><pre class=""><code class="sql -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="CREATE USER tapeuser WITH PASSWORD 'tapeuser-password';" id="code9-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> tapeuser <span class="token keyword">WITH</span> PASSWORD <span class="token string">'tapeuser-password'</span><span class="token punctuation">;</span></div><br></code></pre><blockquote><p><span class="icon-font" data-ignore-text="" style="vertical-align: sub">info</span> <strong>NOTE</strong></p><p>Use a password that is more secure than 'tapeuser-password'.</p></blockquote></li><li><p>Grant the user access to the Tape database.</p><pre class=""><code class="sql -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="GRANT ALL PRIVILEGES ON DATABASE tape to tapeuser;" id="code10-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">PRIVILEGES</span> <span class="token keyword">ON</span> <span class="token keyword">DATABASE</span> tape <span class="token keyword">to</span> tapeuser<span class="token punctuation">;</span></div><br></code></pre></li><li><p>Exit the PostgreSQL interactive terminal.</p><pre class=""><code class="undefined -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="postgres=# \q" id="code11-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>postgres=# \q</div><br></code></pre></li><li><p>Log out of the <em>postgres</em> account.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="exit" id="code12-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token builtin class-name">exit</span></div><br></code></pre></li><li><p>Optional</p><p>If you use a different server for your database and the Tape server, you may allow PostgreSQL to listen on all assigned IP Addresses. To do so, open <code>/etc/postgresql/10/main/postgresql.conf</code> as root in a text editor. As a best practice, ensure that only the Tape server is able to connect to the PostgreSQL port using a firewall.</p><p>Find the following line, uncomment it the line and change <code>localhost</code> to <code>*</code>:</p><pre class="with-bar"><code class="undefined -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11 removed -codedoc-code-line" data-content="    #listen_addresses = 'localhost'" id="code13-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    #listen_addresses = 'localhost'</div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="    listen_addresses = '*'" id="code13-l2"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    listen_addresses = '*'</div><br></code></pre></li><li><p>Modify the file <code>pg_hba.conf</code> to allow the Tape server to communicate with the database.</p><p><strong>10.1. For case when the Tape server and the database are on the same machine</strong>:</p><p>a) Open <code>/etc/postgresql/10/main/pg_hba.conf</code> as root in a text editor.</p><p>b) Find the following line and change <code>peer</code> to <code>trust</code>:</p><pre class="with-bar"><code class="undefined -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11 removed -codedoc-code-line" data-content="    local   all             all                        peer" id="code14-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    local   all             all                        peer</div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="    local   all             all                        trust" id="code14-l2"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    local   all             all                        trust</div><br></code></pre><p><strong>10.2. For case when the Tape server and the database are on different machines</strong>:</p><p>a) Open <code>/etc/postgresql/10/main/pg_hba.conf</code> as root in a text editor.</p><p>b) Add the following line to the end of the file, where <em>{tape-server-IP}</em> is the IP address of the machine that contains the Tape server.</p><pre class=""><code class="undefined -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="host all all {tape-server-IP}/32 md5" id="code15-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>host all all {tape-server-IP}/32 md5</div><br></code></pre></li><li><p>Reload PostgreSQL:</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo systemctl reload postgresql" id="code16-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> systemctl reload postgresql</div><br></code></pre></li><li><p>Verify that you can connect with the user <em>tapeuser</em>.</p><p>a) If the Tape server and the database are on the same machine, use the following command:</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="psql --dbname=tape --username=tapeuser --password" id="code17-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>psql --dbname<span class="token operator">=</span>tape --username<span class="token operator">=</span>tapeuser --password</div><br></code></pre><p>b) If the Tape server is on a different machine, log into that machine and use the following command:</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="psql --host={postgres-server-IP} --dbname=tape --username=tapeuser --password" id="code18-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>psql --host<span class="token operator">=</span><span class="token punctuation">{</span>postgres-server-IP<span class="token punctuation">}</span> --dbname<span class="token operator">=</span>tape --username<span class="token operator">=</span>tapeuser --password</div><br></code></pre><blockquote><p><span class="icon-font" data-ignore-text="" style="vertical-align: sub">help</span> <strong>NOTE</strong></p><p>You might have to install the PostgreSQL client software to use the command.</p></blockquote><p>The PostgreSQL interactive terminal starts. To exit the PostgreSQL interactive terminal, type <code>\q</code> and press <strong>Enter</strong>.</p></li></ol><p>With the database installed and the initial setup complete, you can now install the Tape server.</p><hr><h1 id="installing-and-configuring-redis" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Installing and Configuring Redis</h1><p>In order to get the latest version of Redis, we will use apt to install it from the official Ubuntu repositories.</p><p>Install Redis by typing:</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo apt install redis-server" id="code19-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> redis-server</div><br></code></pre><p>This will download and install Redis and its dependencies. Following this, there is one important configuration change to make in the Redis configuration file, which was generated automatically during the installation.</p><p>Open this file with your preferred text editor:</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo nano /etc/redis/redis.conf" id="code20-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> <span class="token function">nano</span> /etc/redis/redis.conf</div><br></code></pre><p>Inside the file, find the <code>supervised</code> directive. This directive allows you to declare an init system to manage Redis as a service, providing you with more control over its operation. The <code>supervised</code> directive is set to <code>no</code> by default. Since you are running Ubuntu, which uses the <code>systemd</code> init system, change this to <code>systemd</code>:</p><pre class="with-bar"><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span>/etc/redis/redis.conf</span></span><div class="line-0-0-11  -codedoc-code-line" data-content=". . ." id="code21-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="" id="code21-l2"><span class="lineCounter-0-0-10 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="# If you run Redis from upstart or systemd, Redis can interact with your" id="code21-l3"><span class="lineCounter-0-0-10 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token comment"># If you run Redis from upstart or systemd, Redis can interact with your</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="# supervision tree. Options:" id="code21-l4"><span class="lineCounter-0-0-10 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token comment"># supervision tree. Options:</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="#   supervised no      - no supervision interaction" id="code21-l5"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token comment">#   supervised no      - no supervision interaction</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="#   supervised upstart - signal upstart by putting Redis into SIGSTOP mode" id="code21-l6"><span class="lineCounter-0-0-10 -codedoc-line-counter">6<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token comment">#   supervised upstart - signal upstart by putting Redis into SIGSTOP mode</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="#   supervised systemd - signal systemd by writing READY=1 to $NOTIFY_SOCKET" id="code21-l7"><span class="lineCounter-0-0-10 -codedoc-line-counter">7<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token comment">#   supervised systemd - signal systemd by writing READY=1 to $NOTIFY_SOCKET</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="#   supervised auto    - detect upstart or systemd method based on" id="code21-l8"><span class="lineCounter-0-0-10 -codedoc-line-counter">8<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token comment">#   supervised auto    - detect upstart or systemd method based on</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="#                        UPSTART_JOB or NOTIFY_SOCKET environment variables" id="code21-l9"><span class="lineCounter-0-0-10 -codedoc-line-counter">9<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token comment">#                        UPSTART_JOB or NOTIFY_SOCKET environment variables</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="# Note: these supervision methods only signal &quot;process is ready.&quot;" id="code21-l10"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">10<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token comment"># Note: these supervision methods only signal "process is ready."</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="#       They do not enable continuous liveness pings back to your supervisor." id="code21-l11"><span class="lineCounter-0-0-10 -codedoc-line-counter">11<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token comment">#       They do not enable continuous liveness pings back to your supervisor.</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="supervised systemd" id="code21-l12"><span class="lineCounter-0-0-10 -codedoc-line-counter">12<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>supervised systemd</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="" id="code21-l13"><span class="lineCounter-0-0-10 -codedoc-line-counter">13<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content=". . ." id="code21-l14"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">14<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span></div><br></code></pre><p>That’s the only change you need to make to the Redis configuration file at this point, so save and close it when you are finished. Then, restart the Redis service to reflect the changes you made to the configuration file:</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo systemctl restart redis.service" id="code22-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> systemctl restart redis.service</div><br></code></pre><p>With that, you’ve installed and configured Redis and it’s running on your machine. Before you begin using it, though, it’s prudent to first check whether Redis is functioning correctly.</p><hr><h1 id="installing-nodejs-using-a-ppa" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Installing Node.js using a PPA</h1><p>To get a more recent version of Node.js you can add the PPA (personal package archive) maintained by <a href="https://nodesource.com/">NodeSource</a>. This will have more up-to-date versions of <code>Node.js</code> than the official Ubuntu repositories, and will allow you to choose between Node.js v10.x (the Maintenance LTS version, supported until April of 2021), Node.js v12.x (the Active LTS version, supported until April 2022), and Node.js v14.x (the current release, supported until April 2023).</p><p>First, install the PPA in order to get access to its contents. From your home directory, use curl to retrieve the installation script for your preferred version, making sure to replace 12.x with your preferred version string (if different):</p><pre class="with-bar"><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="cd ~" id="code23-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token builtin class-name">cd</span> ~</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="curl -sL https://deb.nodesource.com/setup_12.x -o nodesource_setup.sh" id="code23-l2"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">curl</span> -sL https://deb.nodesource.com/setup_12.x -o nodesource_setup.sh</div><br></code></pre><p>You can inspect the contents of this script with nano (or your preferred text editor):</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="vim nodesource_setup.sh" id="code24-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">vim</span> nodesource_setup.sh</div><br></code></pre><p>Run the script under sudo:</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo bash nodesource_setup.sh" id="code25-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> <span class="token function">bash</span> nodesource_setup.sh</div><br></code></pre><p>The PPA will be added to your configuration and your local package cache will be updated automatically. After running the setup script from Nodesource, you can install the Node.js package in the same way you did above:</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo apt update &amp;&amp; sudo apt install nodejs" id="code26-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> <span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nodejs</div><br></code></pre><p>To check which version of Node.js you have installed after these initial steps, type:</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="nodejs -v" id="code27-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>nodejs -v</div><br></code></pre><hr><h1 id="install-necessary-dependency-packages" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Install necessary dependency packages</h1><h2 id="yarn" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Yarn</h2><p>On Debian or Ubuntu Linux, you can install <a href="https://classic.yarnpkg.com/en/docs/install#debian-stable">Yarn</a> via Debian package repository. You will first need to configure the repository:</p><pre class="with-bar"><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -" id="code28-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">curl</span> -sS https://dl.yarnpkg.com/debian/pubkey.gpg <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="echo &quot;deb https://dl.yarnpkg.com/debian/ stable main&quot; | sudo tee /etc/apt/sources.list.d/yarn.list" id="code28-l2"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token builtin class-name">echo</span> <span class="token string">"deb https://dl.yarnpkg.com/debian/ stable main"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/yarn.list</div><br></code></pre><p>Then you can simply:</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo apt update &amp;&amp; sudo apt install yarn" id="code29-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> <span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">yarn</span></div><br></code></pre><h2 id="knexjs-migration-cli" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Knex.js migration CLI</h2><p>The migration CLI is bundled with the knex install, and is driven by the node-liftoff module. To install globally, run:</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo yarn global add knex" id="code30-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> <span class="token function">yarn</span> global <span class="token function">add</span> knex</div><br></code></pre><hr><h1 id="installing-tape-server" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Installing Tape Server</h1><p>Install Tape Server on a 64-bit machine.</p><p>Assume that the IP address of this server is 10.10.10.2.</p><p><strong>To install Tape Server on Ubuntu</strong></p><ol><li><p>Log in to the server that will host Tape Server and open a terminal window.</p></li><li><p>Download the latest version of the Tape Server on <a href="https://codecanyon.net/user/buildpm/">codecanyon.net</a>.</p></li><li><p>Extract the Tape Server files.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="tar -xvzf tape.X.X.X.gz" id="code31-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">tar</span> -xvzf tape.X.X.X.gz</div><br></code></pre></li><li><p>Create server environment file:</p><pre class="with-bar"><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="cd ./tape/backend/" id="code32-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token builtin class-name">cd</span> ./tape/backend/</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="cp .env.sample.js .env" id="code32-l2"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">cp</span> .env.sample.js .env</div><br></code></pre><blockquote><p><span class="icon-font" data-ignore-text="" style="vertical-align: sub">help</span> <strong>NOTE</strong></p><p>Be patient and add your server configuration environment variables.</p></blockquote></li><li><p>Set up the database environments in the file <code>./tape/.env</code>. Open the file in a text editor and make the following changes:</p><ul><li><p>If you are using PostgreSQL:</p><p>Set <code>"knex.production"</code> to the following value, replacing <code>&lt;username&gt;</code>, <code>&lt;userpassword&gt;</code>, <code>&lt;host-name-or-IP&gt;</code> and <code>&lt;databasename&gt;</code> with the appropriate values:
<code>"postgres://&lt;username&gt;:&lt;userpassword&gt;@&lt;host-name-or-IP&gt;:5432/&lt;databasename&gt;?sslmode=disable&amp;connect_timeout=10"</code>.</p></li></ul></li><li><p>Also set <code>"client.url"</code> to the full base URL of the site (e.g. <code>"https://tape.example.com"</code>).</p></li><li><p>Add new <code>session.secret</code> key generated for example using <code>openssl</code>:</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="openssl rand -base64 48" id="code33-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>openssl rand -base64 <span class="token number">48</span></div><br></code></pre></li><li><p>Update <code>nodemailer</code> configuration section follow this topic <a href="https://nodemailer.com/usage/">Nodemailer Usage</a>.</p><blockquote><p>Nodemailer uses for sending out verify, welcome, reset password emails and others</p></blockquote></li><li><p>Migrate database schemas</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="knex migrate:latest --env production" id="code34-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>knex migrate:latest --env production</div><br></code></pre></li><li><p>Go to frontend and build client</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="cd ../frontend/" id="code35-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/frontend/</div><br></code></pre><p>Before building your client bundle we need to change environment variables. Use <code>.env.production</code> file:</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="vim .env.production" id="code36-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">vim</span> .env.production</div><br></code></pre><p>Then run builder:</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="yarn build" id="code37-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">yarn</span> build</div><br></code></pre></li><li><p>Move the extracted file to the <code>/opt</code> directory.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo mv tape /opt" id="code38-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> <span class="token function">mv</span> tape /opt</div><br></code></pre></li><li><p>Create the storage directory for files.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo mkdir /opt/tape/frontend/build/uploads" id="code39-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> <span class="token function">mkdir</span> /opt/tape/frontend/build/uploads</div><br></code></pre><blockquote><p><span class="icon-font" data-ignore-text="" style="vertical-align: sub">help</span> <strong>NOTE</strong></p><p>The storage directory will contain all the files and images that your users post to Tape, so you need to make sure that the drive is large enough to hold the anticipated number of uploaded files and images.</p></blockquote></li><li><p>Set up a system user and group called <code>thetape</code> that will run this service, and set the ownership and permissions.</p><p>a. Create the Tape user and group:</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo useradd --system --user-group thetape" id="code40-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> <span class="token function">useradd</span> --system --user-group thetape</div><br></code></pre><p>b. Set the user and group <em>thetape</em> as the owner of the Tape files:</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo chown -R thetape:thetape /opt/tape" id="code41-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> <span class="token function">chown</span> -R thetape:thetape /opt/tape</div><br></code></pre><p>c. Give write permissions to the <em>thetape</em> group:</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo chmod -R g+w /opt/tape" id="code42-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> <span class="token function">chmod</span> -R g+w /opt/tape</div><br></code></pre></li><li><p>Test the Tape server to make sure everything works.</p><p>a. Change to the <code>tape</code> directory:
<code>cd /opt/tape</code></p><p>b. Start the Tape server as the user tape:
<code>sudo -u thetape NODE_ENV=production /usr/bin/node ./server.js</code></p><p>When the server starts, it shows some log information and the text <code>API listening on port 3333</code>. You can stop the server by pressing CTRL+C in the terminal window.</p></li><li><p>Setup Tape to use <em>systemd</em> for starting and stopping.</p><p>a. Create a <em>systemd</em> unit file:
<code>sudo touch /lib/systemd/system/tape.service</code></p><p>b. Open the unit file as root in a text editor, and copy the following lines into the file:</p><pre class="with-bar"><code class="cmake -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="[Unit]" id="code43-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>[Unit]</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="Description=Tape" id="code43-l2"><span class="lineCounter-0-0-10 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>Description=Tape</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="After=network.target" id="code43-l3"><span class="lineCounter-0-0-10 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>After=network.target</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="After=nss-lookup.target" id="code43-l4"><span class="lineCounter-0-0-10 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>After=nss-lookup.target</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="After=nginx.target" id="code43-l5"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>After=nginx.target</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="After=postgresql.service" id="code43-l6"><span class="lineCounter-0-0-10 -codedoc-line-counter">6<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>After=postgresql.service</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="BindsTo=postgresql.service" id="code43-l7"><span class="lineCounter-0-0-10 -codedoc-line-counter">7<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>BindsTo=postgresql.service</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="" id="code43-l8"><span class="lineCounter-0-0-10 -codedoc-line-counter">8<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="[Service]" id="code43-l9"><span class="lineCounter-0-0-10 -codedoc-line-counter">9<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>[Service]</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="Type=notify" id="code43-l10"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">10<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>Type=notify</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="ExecStart=/usr/bin/node /opt/tape/backend/server.js" id="code43-l11"><span class="lineCounter-0-0-10 -codedoc-line-counter">11<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>ExecStart=/usr/bin/node /opt/tape/backend/server.js</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="TimeoutStartSec=3600" id="code43-l12"><span class="lineCounter-0-0-10 -codedoc-line-counter">12<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>TimeoutStartSec=<span class="token number">3600</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="Restart=always" id="code43-l13"><span class="lineCounter-0-0-10 -codedoc-line-counter">13<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>Restart=always</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="RestartSec=10" id="code43-l14"><span class="lineCounter-0-0-10 -codedoc-line-counter">14<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>RestartSec=<span class="token number">10</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="WorkingDirectory=/opt/tape/backend" id="code43-l15"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">15<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>WorkingDirectory=/opt/tape/backend</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="User=thetape" id="code43-l16"><span class="lineCounter-0-0-10 -codedoc-line-counter">16<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>User=thetape</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="Group=thetape" id="code43-l17"><span class="lineCounter-0-0-10 -codedoc-line-counter">17<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>Group=thetape</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="LimitNOFILE=49152" id="code43-l18"><span class="lineCounter-0-0-10 -codedoc-line-counter">18<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>LimitNOFILE=<span class="token number">49152</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="Environment=NODE_ENV=production" id="code43-l19"><span class="lineCounter-0-0-10 -codedoc-line-counter">19<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>Environment=NODE_ENV=production</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="" id="code43-l20"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">20<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="[Install]" id="code43-l21"><span class="lineCounter-0-0-10 -codedoc-line-counter">21<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>[Install]</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="WantedBy=postgresql.service" id="code43-l22"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">22<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>WantedBy=postgresql.service</div><br></code></pre><blockquote><p><span class="icon-font" data-ignore-text="" style="vertical-align: sub">help</span> <strong>NOTE</strong></p><p>If you have installed PostgreSQL on a dedicated server, then you need to</p></blockquote><ul><li>remove <code>After=postgresql.service</code> and <code>BindsTo=postgresql.service</code> or <code>After=mysql.service</code> and <code>BindsTo=mysql.service</code> lines in the <code>[Unit]</code> section, and</li><li>replace the <code>WantedBy=postgresql.service</code> or <code>WantedBy=mysql.service</code> line in the <code>[Install]</code> section with <code>WantedBy=multi-user.target</code></li></ul><p>or the Tape service will not start.</p><blockquote><p><span class="icon-font" data-ignore-text="" style="vertical-align: sub">help</span> <strong>NOTE</strong></p><p>Setting <code>WantedBy</code> to your local database service ensures that whenever the database service is started, the Tape server starts too. This prevents the Tape server from stopping to work after an automatic update of the database.</p></blockquote><p>c. Make systemd load the new unit.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo systemctl daemon-reload" id="code44-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> systemctl daemon-reload</div><br></code></pre><p>d. Check to make sure that the unit was loaded.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo systemctl status tape.service" id="code45-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> systemctl status tape.service</div><br></code></pre><p>You should see an output similar to the following:</p><pre class="with-bar"><code class="undefined -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="  ● tape.service - Tape" id="code46-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  ● tape.service - Tape</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    Loaded: loaded (/lib/systemd/system/tape.service; disabled; vendor preset: enabled)" id="code46-l2"><span class="lineCounter-0-0-10 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    Loaded: loaded (/lib/systemd/system/tape.service; disabled; vendor preset: enabled)</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    Active: inactive (dead)" id="code46-l3"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    Active: inactive (dead)</div><br></code></pre><p>e. Start the service.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo systemctl start tape.service" id="code47-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> systemctl start tape.service</div><br></code></pre><p>f. Verify that Tape is running.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="curl http://localhost:3333/" id="code48-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">curl</span> http://localhost:3333/</div><br></code></pre><p>You should see the text <code>Not Found</code> that's returned by the Tape server.</p><p>g. Set Tape to start on machine start up.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo systemctl enable tape.service" id="code49-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> tape.service</div><br></code></pre></li></ol><p>Now that the Tape server is up and running, you can do some initial configuration and setup.</p><hr><h1 id="installing-nginx-server" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Installing NGINX Server</h1><p>In a production setting, use a proxy server for greater security and performance of Tape.</p><p>The main benefits of using a proxy are as follows:</p><ul><li>SSL termination</li><li>HTTP to HTTPS redirect</li><li>Port mapping <code>:80</code> to <code>:3333</code> for rest service</li><li>Standard request logs</li></ul><p><strong>To install NGINX on Ubuntu Server:</strong></p><ol><li><p>Log in to the server that will host the proxy and open a terminal window.</p></li><li><p>Install NGINX.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo apt-get install nginx" id="code50-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> nginx</div><br></code></pre></li><li><p>After the installation is complete, verify that NGINX is running.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="curl http://localhost" id="code51-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">curl</span> http://localhost</div><br></code></pre><p>If NGINX is running, you see the following output:</p><pre class="with-bar"><code class="html -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="<!DOCTYPE html>" id="code52-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="<html>" id="code52-l2"><span class="lineCounter-0-0-10 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="<head>" id="code52-l3"><span class="lineCounter-0-0-10 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="<title>Welcome to nginx!</title>" id="code52-l4"><span class="lineCounter-0-0-10 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Welcome to nginx!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="<p><em>Thank you for using nginx.</em></p>" id="code52-l5"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>Thank you for using nginx.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="</body>" id="code52-l6"><span class="lineCounter-0-0-10 -codedoc-line-counter">6<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="</html>" id="code52-l7"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">7<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></div><br></code></pre><p>You can stop, start, and restart NGINX with the following commands:</p><pre class="with-bar"><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo systemctl stop nginx" id="code53-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> systemctl stop nginx</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="sudo systemctl start nginx" id="code53-l2"><span class="lineCounter-0-0-10 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> systemctl start nginx</div><br><div class="line-0-0-11  -codedoc-code-line" data-content="sudo systemctl restart nginx" id="code53-l3"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> systemctl restart nginx</div><br></code></pre></li></ol><p><strong>What to do next</strong></p><ol><li>Map a fully qualified domain name (FQDN) such as <code>tape.example.com</code> to point to the NGINX server.</li><li>Configure NGINX to proxy connections from the internet to the Tape Server.</li></ol><hr><h1 id="configuring-nginx-as-a-proxy-for-tape-server" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Configuring NGINX as a proxy for Tape Server</h1><p>NGINX is configured using a file in the <code>/etc/nginx/sites-available</code> directory. You need to create the file and then enable it. When creating the file, you need the IP address of your Tape server and the fully qualified domain name (FQDN) of your Tape website.</p><p><strong>To configure NGINX as a proxy</strong></p><ol><li><p>Log in to the server that hosts NGINX and open a terminal window.</p></li><li><p>Create a configuration file for Tape.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo touch /etc/nginx/sites-available/tape" id="code54-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> <span class="token function">touch</span> /etc/nginx/sites-available/tape</div><br></code></pre></li><li><p>Open the file <code>/etc/nginx/sites-available/tape</code> as root in a text editor and replace its contents, if any, with the following lines. Make sure that you use your own values for the Tape server IP address and FQDN for <em>server_name</em>.</p><pre class="with-bar"><code class="nginx -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="upstream backend {" id="code55-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">upstream</span> backend <span class="token punctuation">{</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="  server 127.0.0.1:3333;" id="code55-l2"><span class="lineCounter-0-0-10 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">server</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">3333</span><span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="  keepalive 32;" id="code55-l3"><span class="lineCounter-0-0-10 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">keepalive</span> <span class="token number">32</span><span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="}" id="code55-l4"><span class="lineCounter-0-0-10 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="" id="code55-l5"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=tape_cache:10m max_size=3g inactive=120m use_temp_path=off;" id="code55-l6"><span class="lineCounter-0-0-10 -codedoc-line-counter">6<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">proxy_cache_path</span> <span class="token operator">/</span>var<span class="token operator">/</span>cache<span class="token operator">/</span>nginx levels<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">2</span> keys_zone<span class="token operator">=</span>tape_cache<span class="token punctuation">:</span><span class="token number">10</span>m max_size<span class="token operator">=</span><span class="token number">3</span>g inactive<span class="token operator">=</span><span class="token number">120</span>m use_temp_path<span class="token operator">=</span>off<span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="" id="code55-l7"><span class="lineCounter-0-0-10 -codedoc-line-counter">7<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="server {" id="code55-l8"><span class="lineCounter-0-0-10 -codedoc-line-counter">8<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">server</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="  listen 80 default_server;" id="code55-l9"><span class="lineCounter-0-0-10 -codedoc-line-counter">9<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">listen</span> <span class="token number">80</span> default_server<span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="  server_name tape.example.com;" id="code55-l10"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">10<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">server_name</span> tape<span class="token punctuation">.</span>example<span class="token punctuation">.</span>com<span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="" id="code55-l11"><span class="lineCounter-0-0-10 -codedoc-line-counter">11<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="  access_log /var/log/nginx/tape.access.log;" id="code55-l12"><span class="lineCounter-0-0-10 -codedoc-line-counter">12<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">access_log</span> <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>tape<span class="token punctuation">.</span>access<span class="token punctuation">.</span>log<span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="  error_log /var/log/nginx/tape.error.log;" id="code55-l13"><span class="lineCounter-0-0-10 -codedoc-line-counter">13<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">error_log</span> <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>tape<span class="token punctuation">.</span>error<span class="token punctuation">.</span>log<span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="" id="code55-l14"><span class="lineCounter-0-0-10 -codedoc-line-counter">14<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="  root /opt/tape/frontend/build;" id="code55-l15"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">15<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">root</span> <span class="token operator">/</span>opt<span class="token operator">/</span>tape<span class="token operator">/</span>frontend<span class="token operator">/</span>build<span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="  index index.html;" id="code55-l16"><span class="lineCounter-0-0-10 -codedoc-line-counter">16<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">index</span> <span class="token keyword">index</span><span class="token punctuation">.</span>html<span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="  location / {" id="code55-l17"><span class="lineCounter-0-0-10 -codedoc-line-counter">17<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    if (!-e $request_filename) {" id="code55-l18"><span class="lineCounter-0-0-10 -codedoc-line-counter">18<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">-</span>e <span class="token variable">$request_filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="      rewrite ^(.*)$ /index.html break;" id="code55-l19"><span class="lineCounter-0-0-10 -codedoc-line-counter">19<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>      <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span>$ <span class="token operator">/</span><span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">break</span><span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    }" id="code55-l20"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">20<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="  }" id="code55-l21"><span class="lineCounter-0-0-10 -codedoc-line-counter">21<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="  location ~ ^/(v4)/ {" id="code55-l22"><span class="lineCounter-0-0-10 -codedoc-line-counter">22<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">location</span> <span class="token operator">~</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token punctuation">(</span>v4<span class="token punctuation">)</span><span class="token operator">/</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    client_max_body_size 50M;" id="code55-l23"><span class="lineCounter-0-0-10 -codedoc-line-counter">23<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">client_max_body_size</span> <span class="token number">50</span>M<span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    proxy_set_header Connection &quot;&quot;;" id="code55-l24"><span class="lineCounter-0-0-10 -codedoc-line-counter">24<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">proxy_set_header</span> Connection <span class="token string">""</span><span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    proxy_set_header Host $http_host;" id="code55-l25"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">25<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">proxy_set_header</span> Host <span class="token variable">$http_host</span><span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    proxy_set_header X-Real-IP $remote_addr;" id="code55-l26"><span class="lineCounter-0-0-10 -codedoc-line-counter">26<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Real<span class="token operator">-</span>IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;" id="code55-l27"><span class="lineCounter-0-0-10 -codedoc-line-counter">27<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    proxy_set_header X-Forwarded-Proto $scheme;" id="code55-l28"><span class="lineCounter-0-0-10 -codedoc-line-counter">28<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>Proto <span class="token variable">$scheme</span><span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    proxy_set_header X-Frame-Options SAMEORIGIN;" id="code55-l29"><span class="lineCounter-0-0-10 -codedoc-line-counter">29<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Frame<span class="token operator">-</span>Options SAMEORIGIN<span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    proxy_buffers 256 16k;" id="code55-l30"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">30<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">proxy_buffers</span> <span class="token number">256</span> <span class="token number">16</span>k<span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    proxy_buffer_size 16k;" id="code55-l31"><span class="lineCounter-0-0-10 -codedoc-line-counter">31<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">proxy_buffer_size</span> <span class="token number">16</span>k<span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    proxy_read_timeout 600s;" id="code55-l32"><span class="lineCounter-0-0-10 -codedoc-line-counter">32<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">proxy_read_timeout</span> <span class="token number">600</span>s<span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    proxy_cache tape_cache;" id="code55-l33"><span class="lineCounter-0-0-10 -codedoc-line-counter">33<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">proxy_cache</span> tape_cache<span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    proxy_cache_revalidate on;" id="code55-l34"><span class="lineCounter-0-0-10 -codedoc-line-counter">34<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    proxy_cache_revalidate on<span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    proxy_cache_min_uses 2;" id="code55-l35"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">35<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">proxy_cache_min_uses</span> <span class="token number">2</span><span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    proxy_cache_use_stale timeout;" id="code55-l36"><span class="lineCounter-0-0-10 -codedoc-line-counter">36<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">proxy_cache_use_stale</span> <span class="token keyword">timeout</span><span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    proxy_cache_lock on;" id="code55-l37"><span class="lineCounter-0-0-10 -codedoc-line-counter">37<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">proxy_cache_lock</span> on<span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    proxy_http_version 1.1;" id="code55-l38"><span class="lineCounter-0-0-10 -codedoc-line-counter">38<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">proxy_http_version</span> <span class="token number">1.1</span><span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="    proxy_pass http://backend;" id="code55-l39"><span class="lineCounter-0-0-10 -codedoc-line-counter">39<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>backend<span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="  }" id="code55-l40"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">40<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="}" id="code55-l41"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">41<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span></div><br></code></pre></li><li><p>Remove the existing default sites-enabled file.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo rm /etc/nginx/sites-enabled/default" id="code56-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> <span class="token function">rm</span> /etc/nginx/sites-enabled/default</div><br></code></pre></li><li><p>Enable the tape configuration.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo ln -s /etc/nginx/sites-available/tape /etc/nginx/sites-enabled/tape" id="code57-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> <span class="token function">ln</span> -s /etc/nginx/sites-available/tape /etc/nginx/sites-enabled/tape</div><br></code></pre></li><li><p>Restart NGINX.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo systemctl restart nginx" id="code58-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> systemctl restart nginx</div><br></code></pre></li><li><p>Verify that you can see Tape through the proxy.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="curl http://localhost" id="code59-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">curl</span> http://localhost</div><br></code></pre><p>If everything is working, you will see the HTML for the Tape signin page.</p></li></ol><p>Now that NGINX is installed and running, you can configure it to use SSL, which allows you to use HTTPS connections and the HTTP/2 protocol.</p><hr><h1 id="configuring-nginx-with-ssl-and-http2" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Configuring NGINX with SSL and HTTP/2</h1><p>Using SSL gives greater security by ensuring that communications between Tape clients and the Tape server are encrypted. It also allows you to configure NGINX to use the HTTP/2 protocol.</p><p>Although you can configure HTTP/2 without SSL, both Firefox and Chrome browsers support HTTP/2 on secure connections only.</p><p>You can use any certificate that you want, but these instructions show you how to download and install certificates from <a href="https://letsencrypt.org">Let's Encrypt</a>, a free certificate authority.</p><p><strong>To configure SSL and HTTP/2:</strong></p><ol><li><p>Log in to the server that hosts NGINX and open a terminal window.</p></li><li><p>Install git.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo apt-get install git" id="code60-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">git</span></div><br></code></pre></li><li><p>Clone the Let's Encrypt repository on GitHub.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="git clone https://github.com/letsencrypt/letsencrypt" id="code61-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">git</span> clone https://github.com/letsencrypt/letsencrypt</div><br></code></pre></li><li><p>Change to the <code>letsencrypt</code> directory.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="cd letsencrypt" id="code62-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token builtin class-name">cd</span> letsencrypt</div><br></code></pre></li><li><p>Stop NGINX.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo systemctl stop nginx" id="code63-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> systemctl stop nginx</div><br></code></pre></li><li><p>Run <code>netstat</code> to make sure that nothing is listening on port 80.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="netstat -na | grep ':80.*LISTEN'" id="code64-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">netstat</span> -na <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">':80.*LISTEN'</span></div><br></code></pre></li><li><p>Run the Let's Encrypt installer.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="./letsencrypt-auto certonly --standalone" id="code65-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>./letsencrypt-auto certonly --standalone</div><br></code></pre><p>When prompted, enter your domain name. After the installation is complete, you can find the certificate in the <code>/etc/letsencrypt/live</code> directory.</p></li><li><p>Open the file <code>/etc/nginx/sites-available/tape</code> as root in a text editor and update the <em>server</em> section to incorporate the highlighted lines in the following sample.</p><pre class="with-bar"><code class="nginx -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="..." id="code66-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="server {" id="code66-l2"><span class="lineCounter-0-0-10 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">server</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="  listen 80 default_server;" id="code66-l3"><span class="lineCounter-0-0-10 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">listen</span> <span class="token number">80</span> default_server<span class="token punctuation">;</span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="  server_name   tape.example.com;" id="code66-l4"><span class="lineCounter-0-0-10 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">server_name</span>   tape<span class="token punctuation">.</span>example<span class="token punctuation">.</span>com<span class="token punctuation">;</span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="  return 301 https://$server_name$request_uri;" id="code66-l5"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">return</span> <span class="token number">301</span> <span class="token keyword">https</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token variable">$server_name</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="}" id="code66-l6"><span class="lineCounter-0-0-10 -codedoc-line-counter">6<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="" id="code66-l7"><span class="lineCounter-0-0-10 -codedoc-line-counter">7<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="server {" id="code66-l8"><span class="lineCounter-0-0-10 -codedoc-line-counter">8<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">server</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="  listen 443 ssl http2;" id="code66-l9"><span class="lineCounter-0-0-10 -codedoc-line-counter">9<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">listen</span> <span class="token number">443</span> <span class="token keyword">ssl</span> http2<span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="  server_name    tape.example.com;" id="code66-l10"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">10<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">server_name</span>    tape<span class="token punctuation">.</span>example<span class="token punctuation">.</span>com<span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="" id="code66-l11"><span class="lineCounter-0-0-10 -codedoc-line-counter">11<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="  ssl on;" id="code66-l12"><span class="lineCounter-0-0-10 -codedoc-line-counter">12<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">ssl</span> on<span class="token punctuation">;</span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="  ssl_certificate /etc/letsencrypt/live/tape.example.com/fullchain.pem;" id="code66-l13"><span class="lineCounter-0-0-10 -codedoc-line-counter">13<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">ssl_certificate</span> <span class="token operator">/</span>etc<span class="token operator">/</span>letsencrypt<span class="token operator">/</span>live<span class="token operator">/</span>tape<span class="token punctuation">.</span>example<span class="token punctuation">.</span>com<span class="token operator">/</span>fullchain<span class="token punctuation">.</span>pem<span class="token punctuation">;</span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="  ssl_certificate_key /etc/letsencrypt/live/tape.example.com/privkey.pem;" id="code66-l14"><span class="lineCounter-0-0-10 -codedoc-line-counter">14<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">ssl_certificate_key</span> <span class="token operator">/</span>etc<span class="token operator">/</span>letsencrypt<span class="token operator">/</span>live<span class="token operator">/</span>tape<span class="token punctuation">.</span>example<span class="token punctuation">.</span>com<span class="token operator">/</span>privkey<span class="token punctuation">.</span>pem<span class="token punctuation">;</span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="  ssl_session_timeout 1d;" id="code66-l15"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">15<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">ssl_session_timeout</span> <span class="token number">1</span>d<span class="token punctuation">;</span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="  ssl_protocols TLSv1.2;" id="code66-l16"><span class="lineCounter-0-0-10 -codedoc-line-counter">16<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">ssl_protocols</span> TLSv1<span class="token punctuation">.</span><span class="token number">2</span><span class="token punctuation">;</span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="  ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256';" id="code66-l17"><span class="lineCounter-0-0-10 -codedoc-line-counter">17<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">ssl_ciphers</span> <span class="token string">'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256'</span><span class="token punctuation">;</span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="  ssl_prefer_server_ciphers on;" id="code66-l18"><span class="lineCounter-0-0-10 -codedoc-line-counter">18<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">ssl_prefer_server_ciphers</span> on<span class="token punctuation">;</span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="  ssl_session_cache shared:SSL:50m;" id="code66-l19"><span class="lineCounter-0-0-10 -codedoc-line-counter">19<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">ssl_session_cache</span> shared<span class="token punctuation">:</span><span class="token keyword">SSL</span><span class="token punctuation">:</span><span class="token number">50</span>m<span class="token punctuation">;</span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="  # HSTS (ngx_http_headers_module is required) (15768000 seconds = 6 months)" id="code66-l20"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">20<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token comment"># HSTS (ngx_http_headers_module is required) (15768000 seconds = 6 months)</span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="  add_header Strict-Transport-Security max-age=15768000;" id="code66-l21"><span class="lineCounter-0-0-10 -codedoc-line-counter">21<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">add_header</span> Strict<span class="token operator">-</span>Transport<span class="token operator">-</span>Security max<span class="token operator">-</span>age<span class="token operator">=</span><span class="token number">15768000</span><span class="token punctuation">;</span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="  # OCSP Stapling ---" id="code66-l22"><span class="lineCounter-0-0-10 -codedoc-line-counter">22<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token comment"># OCSP Stapling ---</span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="  # fetch OCSP records from URL in ssl_certificate and cache them" id="code66-l23"><span class="lineCounter-0-0-10 -codedoc-line-counter">23<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token comment"># fetch OCSP records from URL in ssl_certificate and cache them</span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="  ssl_stapling on;" id="code66-l24"><span class="lineCounter-0-0-10 -codedoc-line-counter">24<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">ssl_stapling</span> on<span class="token punctuation">;</span></div><br><div class="line-0-0-11 added -codedoc-code-line" data-content="  ssl_stapling_verify on;" id="code66-l25"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">25<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">ssl_stapling_verify</span> on<span class="token punctuation">;</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="  ..." id="code66-l26"><span class="lineCounter-0-0-10 -codedoc-line-counter">26<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></div><br><div class="line-0-0-11  -codedoc-code-line" data-content="}" id="code66-l27"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">27<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span></div><br></code></pre></li><li><p>Start NGINX.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="sudo systemctl start nginx" id="code67-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">sudo</span> systemctl start nginx</div><br></code></pre></li><li><p>Check that your SSL certificate is set up correctly.</p><ul><li>Test the SSL certificate by visiting a site such as <a href="https://www.ssllabs.com/ssltest/index.html">https://www.ssllabs.com/ssltest/index.html</a></li><li>If there’s an error about the missing chain or certificate path, there is likely an intermediate certificate missing that needs to be included.</li></ul></li><li><p>Configure <code>cron</code> so that the certificate will automatically renew every month.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="crontab -e" id="code68-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">crontab</span> -e</div><br></code></pre><p>In the following line, use your own domain name in place of <code>tape.example.com</code>.</p><pre class=""><code class="bash -codedoc-code-snippet code-0-0-9" tabindex="0"><span class="wmbar-0-0-12"><span></span><span></span><span></span><span></span></span><div class="line-0-0-11  -codedoc-code-line" data-content="@monthly /home/ubuntu/letsencrypt/letsencrypt-auto certonly --reinstall --nginx -d tape.example.com &amp;&amp; sudo systemctl restart nginx" id="code69-l1"><span class="lineCounter-0-0-10 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>@monthly /home/ubuntu/letsencrypt/letsencrypt-auto certonly --reinstall --nginx -d tape.example.com <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> systemctl restart nginx</div><br></code></pre></li></ol><div class="contentnav-0-0-8" data-no-search=""><a href="#software-and-hardware-requirements" class="h1" data-content-highlight="software-and-hardware-requirements">Software and Hardware Requirements</a><a href="#software-requirements" class="h2" data-content-highlight="software-requirements">Software Requirements</a><a href="#client-software" class="h3" data-content-highlight="client-software">Client Software</a><a href="#http-web" class="h4" data-content-highlight="http-web"> Web</a><a href="#mail_outline-email-client" class="h3" data-content-highlight="mail_outline-email-client"> Email Client</a><a href="#server-software" class="h2" data-content-highlight="server-software">Server Software</a><a href="#tape-server-operating-system" class="h3" data-content-highlight="tape-server-operating-system">Tape Server Operating System</a><a href="#database-software" class="h3" data-content-highlight="database-software">Database Software</a><a href="#hardware-requirements" class="h2" data-content-highlight="hardware-requirements">Hardware Requirements</a><a href="#people_outline-hardware-requirements-for-team-deployments" class="h3" data-content-highlight="people_outline-hardware-requirements-for-team-deployments"> Hardware Requirements for Team Deployments</a><a href="#hardware-requirements-for-multi-server-deployments" class="h3" data-content-highlight="hardware-requirements-for-multi-server-deployments">Hardware Requirements for Multi-Server Deployments</a><a href="#scale-requirements" class="h4" data-content-highlight="scale-requirements">Scale Requirements</a><a href="#system-requirements" class="h4" data-content-highlight="system-requirements">System Requirements</a><a href="#storage-storage-calculations" class="h3" data-content-highlight="storage-storage-calculations"> Storage Calculations</a><a href="#introduction" class="h1" data-content-highlight="introduction">Introduction</a><a href="#installing-ubuntu-server-1804-lts" class="h1" data-content-highlight="installing-ubuntu-server-1804-lts">Installing Ubuntu Server 18.04 LTS</a><a href="#installing-ubuntu-server-2004-lts" class="h1" data-content-highlight="installing-ubuntu-server-2004-lts">Installing Ubuntu Server 20.04 LTS</a><a href="#installing-postgresql-database-server" class="h1" data-content-highlight="installing-postgresql-database-server">Installing PostgreSQL Database Server</a><a href="#installing-and-configuring-redis" class="h1" data-content-highlight="installing-and-configuring-redis">Installing and Configuring Redis</a><a href="#installing-nodejs-using-a-ppa" class="h1" data-content-highlight="installing-nodejs-using-a-ppa">Installing Node.js using a PPA</a><a href="#install-necessary-dependency-packages" class="h1" data-content-highlight="install-necessary-dependency-packages">Install necessary dependency packages</a><a href="#yarn" class="h2" data-content-highlight="yarn">Yarn</a><a href="#knexjs-migration-cli" class="h2" data-content-highlight="knexjs-migration-cli">Knex.js migration CLI</a><a href="#installing-tape-server" class="h1" data-content-highlight="installing-tape-server">Installing Tape Server</a><a href="#installing-nginx-server" class="h1" data-content-highlight="installing-nginx-server">Installing NGINX Server</a><a href="#configuring-nginx-as-a-proxy-for-tape-server" class="h1" data-content-highlight="configuring-nginx-as-a-proxy-for-tape-server">Configuring NGINX as a proxy for Tape Server</a><a href="#configuring-nginx-with-ssl-and-http2" class="h1" data-content-highlight="configuring-nginx-with-ssl-and-http2">Configuring NGINX with SSL and HTTP/2</a></div></div><div id="-codedoc-toc" class="toc-0-0-5"><script>
     if (window.matchMedia('(min-width: 1200px)').matches) {
       if (!localStorage.getItem('-codedoc-toc-active')) {
         localStorage.setItem('-codedoc-toc-active', "true");
       }
     }
     </script><div class="content-0-0-6"><p><a href="/">Overview</a>
<a href="/docs/installing-tape">Installing Tape</a>
<a href="/docs/account">Account</a>
<a href="/docs/contacts">Contacts</a>
<a href="/docs/groups">Groups</a>
<a href="/docs/messaging">Messaging</a></p><marker><!-- [Search](/docs/search) -->
</marker><marker><!-- [Calls](/docs/calls) -->
</marker><marker><!-- [Settings](/docs/settings) -->
</marker></div></div><div class="footer-0-0-4"><div class="left"><script id="yiVoQbxYbL">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("yiVoQbxYbL", "BQk95uyIFMXeerSJCFCJHA==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div><div class="main"><div class="inside"></div></div><div class="right"><script id="zSRwBnKGr_">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("zSRwBnKGr_", "VTmHzL6hUlN4nEHqWQJatw==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div></div><script id="hsJRjFNCqQ">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("hsJRjFNCqQ", "Le29LofECp4Ny+JWbRsEpA==", {"namespace":""});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></body></html>